- name: Download config file
  get_url:
    url: https://raw.githubusercontent.com/manhtd98/Viettel-Digital-Talent-2023/mid2/Midterm/Tran%20Duc%20Manh/roles/nginx/files/api.conf
    dest: /home/ubuntu/api.conf
    mode: 0440
  become: yes

- name: Download config file
  get_url:
    url: https://raw.githubusercontent.com/manhtd98/Viettel-Digital-Talent-2023/mid2/Midterm/Tran%20Duc%20Manh/roles/nginx/files/webserver.conf
    dest: /home/ubuntu/webserver.conf
    mode: 0440
  become: yes



- name: Start Nginx load balancer
  community.docker.docker_container:
    name: nginx_loadbalancer
    image: nginx:latest
    # state: started
    restart: true
    ports:
      - "8088:8088"
      - "4040:4040"
    volumes:
      - /home/ubuntu/api.conf:/etc/nginx/conf.d/default.conf
      - /home/ubuntu/webserver.conf:/etc/nginx/conf.d/webserver.conf
    # storage_opts:
    #   # Limit root filesystem to 12 MB - note that this requires special storage backends
    #   # (https://fabianlee.org/2020/01/15/docker-use-overlay2-with-an-xfs-backing-filesystem-to-limit-rootfs-size/)
    #   size: 12m
    # healthcheck:
    #   # Check if nginx server is healthy by curl'ing the server.
    #   # If this fails or timeouts, the healthcheck fails.
    #   test: ["CMD", "curl", "--fail", "http://nginx.host.com"]
    #   interval: 1m30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 30s
  become: yes