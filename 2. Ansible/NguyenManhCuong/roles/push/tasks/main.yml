- name: Log into DockerHub
  docker_login:
    username: "{{ dockerhub_username }}"
    password: "{{ dockerhub_password }}"

- name: Build and push images to docker hub
  docker_image:
    build:
      path: "{{ item.path }}"
    name: "vansonpt/{{ item.name }}"
    tag: "{{ image_version }}"
    push: true
    source: build
  loop:
    - { path: "./source_code/api", name: "api" }
    - { path: "./source_code/web", name: "nginx" }

- name: Log out of DockerHub
  docker_login:
    state: absent

