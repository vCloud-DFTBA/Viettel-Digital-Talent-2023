---
# tasks file for web
- name: Install and run Web Server
  block:
  - name: Pull Nginx image
    community.general.docker_image:
      name: "{{ nginx_image }}"
      tag: "{{ nginx_tag }}"
      source: pull
      state: present
      force_source: true
  
  - name: Create Nginx container
    community.general.docker_container:
      name: "{{ nginx_container_name }}"
      image: "{{ nginx_image }}:{{ nginx_tag }}"
      state: present
  
  - name: Run Nginx container
    community.general.docker_container:
      name: "{{ nginx_container_name }}"
      image: "{{ nginx_image }}:{{ nginx_tag }}"
      exposed_ports:
        - 1234
      published_ports:
        - "1234:1234"
      log_driver: fluentd
      log_options:
        fluentd-address: "192.168.0.133:24224"
        fluentd-async-connect: "true"
        tag: "docker.web"
      restart_policy: unless-stopped
      state: started
